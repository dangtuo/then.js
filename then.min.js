/**
* then.js v0.9.4 by @zensh
*/
"use strict";!function(){function a(){}function b(a){return null===a||"undefined"==typeof a}function c(a){return"function"==typeof a}function d(a,b,c){return new Error("Argument "+a+' in "'+b+'" function is not a '+c+"!")}function e(a,e,f,g){function h(c,d,e){k-=1,l[c]=e,(0>=k||!b(d))&&a(d||null,l)}var i,j,k,l=[];if(h._next_then={},p(e))if(c(f))if(k=j=e.length)for(i=0;j>i;i++)f.call(g,h.bind(null,i),e[i],i,e);else a(null,l);else a(d(f,"each","function"));else a(d(e,"each","array"))}function f(a,e,f,g){function h(c,d){k[j]=d,j+=1,i>j&&b(c)?f.call(g,h,e[j],j,e):(delete k[-1],a(c||null,k))}var i,j=-1,k=[];h._next_then={},p(e)?c(f)?(i=e.length,i?h():a(null,k)):a(d(f,"eachSeries","function")):a(d(e,"eachSeries","array"))}function g(a,e,f){function g(c,d,e){j-=1,k[c]=e,(0>=j||!b(d))&&a(d||null,k)}var h,i,j,k=[];if(g._next_then={},p(e))if(j=i=e.length)for(h=0;i>h;h++)c(e[h])?e[h].call(f,g.bind(null,h),h):a(d(e[h],"parallel","function"));else a(null,k);else a(d(e,"parallel","array"))}function h(a,e,f){function g(k,l){j[i]=l,i+=1,h>i&&b(k)?c(e[i])?e[i].call(f,g,i):a(d(e[i],"series","function")):(delete j[-1],a(k||null,j))}var h,i=-1,j=[];g._next_then={},p(e)?(h=e.length,h?g():a(null,j)):a(d(e,"series","array"))}function i(a,b){q(function(){try{b()}catch(c){a(c)}})}function j(a,b){return c(b)?b._next_then?b:b.bind(null,a):null}function k(d){function i(a,b){var c=new m,d=c.defer.bind(c);return d._next_then=c,a(d,b),c}var k=[],l=0,m=function(){},n=m.prototype;return n.debug=!d||c(d)?d:"object"==typeof console&&c(console.log)&&function(){console.log.apply(console,arguments)},n.all=function(a){return i(function(b,c){c._all=j(b,a)},this)},n.then=function(a,b){return i(function(c,d){d._success=j(c,a),d._error=j(c,b)},this)},n.fail=function(a){return i(function(b,c){c._fail=j(b,a),c._success=b.bind(b,null),c._fail&&k.push(c._fail)},this)},n.each=function(a,b,c){return i(function(d,f){f._each=function(f,g,h){e(d,a||f,b||g,c||h)}},this)},n.eachSeries=function(a,b,c){return i(function(d,e){e._eachSeries=function(e,g,h){f(d,a||e,b||g,c||h)}},this)},n.parallel=function(a,b){return i(function(c,d){d._parallel=function(d,e){g(c,a||d,b||e)}},this)},n.series=function(a,b){return i(function(c,d){d._series=function(d,e){h(c,a||d,b||e)}},this)},n.defer=function(c){l+=1,this._error=this._fail?k.shift():this._error,this._success=this._success||this._each||this._eachSeries||this._parallel||this._series||a;try{if(this.debug){var d=o.call(arguments);d.unshift("\nResult of chain "+l+":"),this.debug.apply(this.debug,d)}if(this._all)this._all.apply(this._all._next_then,o.call(arguments));else{if(!b(c))throw c;this._success.apply(this._success._next_then,o.call(arguments,1))}}catch(e){if(!this._error&&!k.length)throw e;(this._error?this._error:k.shift()).call(this,e)}finally{this._all=a}},i}function l(a){return function(b,c,d,e){return k(e)(function(e){i(e,a.bind(null,e,b,c,d))})}}function m(a){return function(b,c,d){return k(d)(function(d){i(d,a.bind(null,d,b,c))})}}function n(a,b,d){return k(d)(function(d){i(d,c(a)?a.bind(b,d):d)})}var o=[].slice,p=Array.isArray,q="object"==typeof process&&c(process.nextTick)?process.nextTick:setTimeout;return n.each=l(e),n.eachSeries=l(f),n.parallel=m(g),n.series=m(h),"undefined"!=typeof module&&module.exports?module.exports=n:"function"==typeof define&&define(function(){return n}),"object"==typeof window&&(window.then=n),n}();